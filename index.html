<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brew Buddy</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,500;0,9..144,600;0,9..144,700;0,9..144,800;0,9..144,900;1,9..144,400&family=Nunito:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --font-display: 'Fraunces', serif;
      --font-body: 'Nunito', sans-serif;
      --text-lg: 1.75rem;   /* 28px - titles, timer */
      --text-md: 1rem;      /* 16px - body, values, section heads */
      --text-sm: 0.75rem;   /* 12px - labels, captions */
    }
    
    * { font-family: var(--font-body); }
    body { -webkit-font-smoothing: antialiased; }
    h1, h2, h3 { font-family: var(--font-display); font-weight: 600; }
    
    .text-lg { font-size: var(--text-lg); }
    .text-md { font-size: var(--text-md); }
    .text-sm { font-size: var(--text-sm); }
    
    .pb-safe { padding-bottom: env(safe-area-inset-bottom, 0); }
    
    /* Hide number input spinners */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'display': ['Fraunces', 'serif'],
            'body': ['Nunito', 'sans-serif'],
            'mono': ['Space Mono', 'monospace'],
          }
        }
      }
    }
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Icon components using Lucide
    const Icon = ({ name, className = "w-6 h-6", ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current && lucide[name]) {
          ref.current.innerHTML = '';
          const icon = lucide.createElement(lucide.icons[name]);
          icon.setAttribute('class', className);
          Object.entries(props).forEach(([key, value]) => {
            if (key !== 'fill') icon.setAttribute(key.replace(/([A-Z])/g, '-$1').toLowerCase(), value);
          });
          if (props.fill) icon.setAttribute('fill', props.fill);
          ref.current.appendChild(icon);
        }
      }, [name, className, props]);
      return <span ref={ref} className="inline-flex" />;
    };

    const Coffee = (props) => <Icon name="Coffee" {...props} />;
    const Timer = (props) => <Icon name="Timer" {...props} />;
    const Settings = (props) => <Icon name="Settings" {...props} />;
    const Droplets = (props) => <Icon name="Droplets" {...props} />;
    const Thermometer = (props) => <Icon name="Thermometer" {...props} />;
    const History = (props) => <Icon name="History" {...props} />;
    const Play = (props) => <Icon name="Play" {...props} />;
    const Pause = (props) => <Icon name="Pause" {...props} />;
    const RotateCcw = (props) => <Icon name="RotateCcw" {...props} />;
    const CheckCircle = (props) => <Icon name="CheckCircle" {...props} />;
    const ChevronRight = (props) => <Icon name="ChevronRight" {...props} />;
    const ChevronLeft = (props) => <Icon name="ChevronLeft" {...props} />;
    const Flame = (props) => <Icon name="Flame" {...props} />;
    const Scale = (props) => <Icon name="Scale" {...props} />;
    const Save = (props) => <Icon name="Save" {...props} />;
    const Star = (props) => <Icon name="Star" {...props} />;

    const COUNTRIES = [
      'Ethiopia', 'Colombia', 'Brazil', 'Guatemala', 'Costa Rica', 
      'Kenya', 'Indonesia', 'Honduras', 'Panama', 'El Salvador', 
      'Nepal', 'India', 'Other'
    ];

    const VARIETALS = [
      'Heirloom', 'Bourbon', 'Typica', 'Caturra', 'Catuai', 
      'Geisha', 'SL-28', 'SL-34', 'Pacamara', 'Castillo', 'Blend', 'Other'
    ];

    const METHODS = {
      v60: {
        name: 'Hario V60',
        defaultRatio: 16,
        description: 'The gold standard for pour-over. Bright and clean.',
        baseGrind: 'Medium-Fine',
        totalTime: 180
      },
      v60_switch: {
        name: 'V60 Switch',
        defaultRatio: 15,
        description: 'Hybrid immersion/percolation. Excellent body and sweetness.',
        baseGrind: 'Medium',
        totalTime: 240
      },
      origami: {
        name: 'Origami',
        defaultRatio: 16,
        description: 'Versatile dripper. Rapid flow rate for clarity.',
        baseGrind: 'Medium-Fine',
        totalTime: 165
      },
      aeropress: {
        name: 'AeroPress',
        defaultRatio: 13,
        description: 'Fast, pressurized brew. Rich and concentrated.',
        baseGrind: 'Fine',
        totalTime: 120
      }
    };

    const ROAST_TEMPS = {
      light: { range: '205°F - 210°F', value: 207, description: 'High temp to extract harder-to-dissolve compounds.' },
      medium: { range: '199°F - 205°F', value: 201, description: 'Balanced temp for sweetness and acidity.' },
      dark: { range: '176°F - 185°F', value: 185, description: 'Lower temp to avoid bitterness and astringency.' }
    };

    const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false }) => {
      const baseStyles = "px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2 active:scale-95";
      const variants = {
        primary: "bg-gradient-to-r from-purple-600 to-purple-500 text-white hover:from-purple-500 hover:to-purple-400 shadow-lg shadow-purple-500/25 disabled:opacity-50 disabled:cursor-not-allowed",
        secondary: "bg-gray-800 text-gray-200 hover:bg-gray-700 border border-gray-700 disabled:opacity-50",
        outline: "border-2 border-purple-500/50 text-purple-400 hover:border-purple-400 hover:text-purple-300",
        ghost: "text-gray-400 hover:bg-gray-800 hover:text-gray-200",
        danger: "bg-red-500/20 text-red-400 hover:bg-red-500/30 border border-red-500/30"
      };
      
      return (
        <button 
          onClick={onClick} 
          disabled={disabled}
          className={`${baseStyles} ${variants[variant]} ${className}`}
          style={{fontSize: '0.875rem'}}
        >
          {children}
        </button>
      );
    };

    const Card = ({ children, className = '' }) => (
      <div className={`bg-gray-900/80 rounded-xl border border-purple-500/20 p-4 backdrop-blur-sm ${className}`}>
        {children}
      </div>
    );

    function App() {
      const [method, setMethod] = useState('v60');
      const [roast, setRoast] = useState('medium');
      const [origin, setOrigin] = useState('Ethiopia');
      const [varietal, setVarietal] = useState('Heirloom');
      const [coffeeAmount, setCoffeeAmount] = useState(20); 
      const [ratio, setRatio] = useState(16); 
      const [waterTemp, setWaterTemp] = useState(94);
      const [roastDate, setRoastDate] = useState('');
      const [view, setView] = useState('config');
      const [logs, setLogs] = useState([]);

      const waterAmount = Math.round((coffeeAmount || 0) * (ratio || 0));
      const currentMethod = METHODS[method];

      const getDynamicGrind = () => {
        const base = currentMethod.baseGrind;
        const finerVarietals = ['Geisha', 'Heirloom', 'SL-28', 'SL-34'];
        const coarserVarietals = ['Blend', 'Other'];

        if (finerVarietals.includes(varietal)) {
          if (base === 'Medium') return 'Medium-Fine (adjusted for varietal)';
          if (base === 'Medium-Fine') return 'Fine-Medium (adjusted for varietal)';
        }
        
        if (coarserVarietals.includes(varietal)) {
           if (base === 'Medium-Fine') return 'Medium (adjusted for varietal)';
           if (base === 'Fine') return 'Medium-Fine (adjusted for varietal)';
        }

        return base;
      };

      const getBrewPrediction = () => {
        const isHighRatio = ratio >= 17;
        const isLowRatio = ratio <= 14;
        const isHotTemp = waterTemp >= 205;
        const isCoolTemp = waterTemp <= 185;
        
        let body = 'medium';
        let acidity = 'balanced';
        let flavor = '';
        
        // Ratio effects
        if (isLowRatio) {
          body = 'full';
          flavor = 'concentrated and bold';
        } else if (isHighRatio) {
          body = 'light';
          flavor = 'delicate and tea-like';
        } else {
          flavor = 'well-rounded';
        }
        
        // Temp effects
        if (isHotTemp) {
          acidity = 'bright';
        } else if (isCoolTemp) {
          acidity = 'mellow';
        }
        
        // Method effects
        let methodNote = '';
        if (method === 'aeropress') {
          methodNote = 'Rich mouthfeel with low bitterness.';
        } else if (method === 'v60') {
          methodNote = 'Clean cup with clarity.';
        } else if (method === 'v60_switch') {
          methodNote = 'Balanced sweetness with body.';
        } else if (method === 'origami') {
          methodNote = 'Crisp and vibrant extraction.';
        }
        
        // Roast effects
        let roastNote = '';
        if (roast === 'light') {
          roastNote = 'Expect floral and fruity notes.';
        } else if (roast === 'medium') {
          roastNote = 'Expect caramel and nutty notes.';
        } else {
          roastNote = 'Expect chocolate and smoky notes.';
        }
        
        return `${body.charAt(0).toUpperCase() + body.slice(1)} body, ${acidity} acidity, ${flavor}. ${methodNote} ${roastNote}`;
      };

      const generateSteps = () => {
        const bloomWater = coffeeAmount * 2.5;
        
        switch (method) {
          case 'v60':
          case 'origami':
            return [
              { name: 'Bloom', description: 'Pour just enough water to wet grounds. Swirl gently.', duration: 45, waterTarget: Math.round(bloomWater) },
              { name: 'Main Pour', description: 'Pour remaining water in slow spirals.', duration: 45, waterTarget: waterAmount },
              { name: 'Drawdown', description: 'Gently swirl and tap. Wait for total drain.', duration: currentMethod.totalTime - 90, waterTarget: waterAmount }
            ];
          case 'v60_switch':
            return [
              { name: 'Bloom (Open)', description: 'Switch open. Wet grounds for degassing.', duration: 30, waterTarget: Math.round(bloomWater) },
              { name: 'Immersion Phase', description: 'Close switch. Pour all remaining water.', duration: 150, waterTarget: waterAmount },
              { name: 'Release', description: 'Open switch to let coffee drain.', duration: 60, waterTarget: waterAmount }
            ];
          case 'aeropress':
            return [
              { name: 'Initial Pour', description: 'Add all water rapidly.', duration: 15, waterTarget: waterAmount },
              { name: 'Stir & Seal', description: 'Stir 3 times, insert plunger to create vacuum.', duration: 75, waterTarget: waterAmount },
              { name: 'Plunge', description: 'Press down gently (30s) until you hear the hiss.', duration: 30, waterTarget: waterAmount }
            ];
          default:
            return [];
        }
      };

      const steps = generateSteps();

      const configView = (
        <div className="space-y-4 pb-6">
          <div className="flex flex-col items-center justify-center mb-6">
            <Coffee className="w-14 h-14 text-purple-400 mb-2" />
            <h1 className="text-white" style={{fontFamily: "'Pacifico', cursive", fontSize: '2.25rem'}}>
              Brew Buddy
            </h1>
          </div>

          <Card>
            <h2 className="font-semibold text-white mb-3 flex items-center gap-2" style={{fontFamily: "'Fraunces', serif", fontSize: '0.9rem'}}>
              <Droplets className="w-4 h-4 text-green-400" />
              Equipment & Beans
            </h2>
            
            <div className="space-y-4">
              <div>
                <label className="block font-semibold text-gray-400 mb-2 uppercase tracking-wide" style={{fontSize: '0.75rem'}}>Brew Method</label>
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
                  {Object.entries(METHODS).map(([key, m]) => (
                    <button
                      key={key}
                      onClick={() => {
                        setMethod(key);
                        setRatio(m.defaultRatio);
                      }}
                      className={`flex flex-col items-center justify-center p-2 rounded-lg border font-semibold transition-all h-16 ${
                        method === key 
                          ? 'border-purple-500 bg-purple-500/10 text-purple-300 ring-1 ring-purple-500/50' 
                          : 'border-gray-700 text-gray-400 hover:bg-gray-800 hover:border-gray-600'
                      }`}
                      style={{fontSize: '0.7rem'}}
                    >
                      <span className="text-center leading-tight">{m.name}</span>
                    </button>
                  ))}
                </div>
              </div>

              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block font-semibold text-gray-400 mb-1.5 uppercase tracking-wide" style={{fontSize: '0.65rem'}}>Origin</label>
                  <select
                    value={origin}
                    onChange={(e) => setOrigin(e.target.value)}
                    className="w-full border border-gray-700 rounded-lg px-2 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none bg-gray-800 font-medium text-gray-200"
                    style={{fontSize: '0.875rem'}}
                  >
                    {COUNTRIES.map((c) => (
                      <option key={c} value={c}>{c}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block font-semibold text-gray-400 mb-1.5 uppercase tracking-wide" style={{fontSize: '0.65rem'}}>Varietal</label>
                  <select
                    value={varietal}
                    onChange={(e) => setVarietal(e.target.value)}
                    className="w-full border border-gray-700 rounded-lg px-2 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none bg-gray-800 font-medium text-gray-200"
                    style={{fontSize: '0.875rem'}}
                  >
                    {VARIETALS.map((v) => (
                      <option key={v} value={v}>{v}</option>
                    ))}
                  </select>
                </div>
              </div>

               <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block font-semibold text-gray-400 mb-1.5 uppercase tracking-wide" style={{fontSize: '0.65rem'}}>Roast Level</label>
                  <div className="flex bg-gray-800 p-0.5 rounded-lg border border-gray-700">
                    {['light', 'medium', 'dark'].map((r) => (
                      <button
                        key={r}
                        onClick={() => {
                          setRoast(r);
                          setWaterTemp(ROAST_TEMPS[r].value);
                        }}
                        className={`flex-1 py-1.5 font-semibold rounded-md capitalize transition-all ${
                          roast === r ? 'bg-purple-500/20 text-purple-300' : 'text-gray-500 hover:text-gray-300'
                        }`}
                        style={{fontSize: '0.7rem'}}
                      >
                        {r}
                      </button>
                    ))}
                  </div>
                </div>
                <div>
                  <label className="block font-semibold text-gray-400 mb-1.5 uppercase tracking-wide" style={{fontSize: '0.65rem'}}>Roast Date</label>
                  <input 
                    type="date" 
                    value={roastDate}
                    onChange={(e) => setRoastDate(e.target.value)}
                    className="w-full border border-gray-700 rounded-lg px-2 py-1.5 focus:ring-2 focus:ring-purple-500 focus:outline-none bg-gray-800 font-medium text-gray-200"
                    style={{fontSize: '0.875rem', colorScheme: 'dark'}}
                  />
                </div>
              </div>
            </div>
          </Card>

          <Card>
            <h2 className="font-semibold text-white mb-3 flex items-center gap-2" style={{fontFamily: "'Fraunces', serif", fontSize: '0.9rem'}}>
              <Scale className="w-4 h-4 text-green-400" />
              Recipe Parameters
            </h2>

            <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block font-semibold text-gray-400 mb-1.5 uppercase tracking-wide text-center" style={{fontSize: '0.65rem'}}>Coffee (g)</label>
                  <input 
                    type="number" 
                    min="1" 
                    max="100" 
                    value={coffeeAmount} 
                    onChange={(e) => setCoffeeAmount(e.target.value === '' ? '' : Number(e.target.value))}
                    className="w-full border border-gray-700 rounded-lg py-1.5 focus:ring-2 focus:ring-purple-500 focus:outline-none bg-gray-800 font-bold text-green-400 text-center appearance-none"
                    style={{fontSize: '1rem'}}
                  />
                </div>

                <div>
                  <label className="block font-semibold text-gray-400 mb-1.5 uppercase tracking-wide text-center" style={{fontSize: '0.65rem'}}>Ratio (1:X)</label>
                  <input 
                    type="number" 
                    min="1" 
                    max="30" 
                    step="0.5"
                    value={ratio} 
                    onChange={(e) => setRatio(e.target.value === '' ? '' : Number(e.target.value))}
                    className="w-full border border-gray-700 rounded-lg py-1.5 focus:ring-2 focus:ring-purple-500 focus:outline-none bg-gray-800 font-bold text-green-400 text-center appearance-none"
                    style={{fontSize: '1rem'}}
                  />
                </div>
              </div>

              <div className="bg-gradient-to-br from-purple-500/10 to-green-500/10 rounded-xl p-3 grid grid-cols-3 gap-2 border border-purple-500/20 mt-4">
                 <div className="text-center p-2">
                    <Droplets className="w-4 h-4 text-purple-400 mx-auto mb-1" />
                    <span className="font-bold text-green-400 block" style={{fontSize: '0.875rem'}}>{waterAmount}ml</span>
                    <span className="text-gray-500 font-semibold uppercase tracking-wider" style={{fontSize: '0.6rem'}}>Water</span>
                 </div>
                 <div className="text-center p-2 border-x border-purple-500/20">
                    <Thermometer className="w-4 h-4 text-purple-400 mx-auto mb-1" />
                    <span className="font-bold text-green-400 block" style={{fontSize: '0.875rem'}}>{waterTemp}°F</span>
                    <span className="text-gray-500 font-semibold uppercase tracking-wider" style={{fontSize: '0.6rem'}}>Temp</span>
                 </div>
                 <div className="text-center p-2">
                    <Settings className="w-4 h-4 text-purple-400 mx-auto mb-1" />
                    <span className="font-semibold text-gray-200 block leading-tight" style={{fontSize: '0.75rem'}}>
                      {getDynamicGrind().split(' ')[0]}
                    </span>
                    <span className="text-gray-500 font-semibold uppercase tracking-wider" style={{fontSize: '0.6rem'}}>Grind</span>
                 </div>
              </div>
          </Card>

          <div className="bg-gray-900 border border-green-500/30 text-gray-300 p-3 rounded-xl flex gap-3 items-start">
            <div className="bg-green-500/20 p-1.5 rounded-full shrink-0">
              <Flame className="w-4 h-4 text-green-400" />
            </div>
            <div>
              <p className="font-semibold text-green-400 mb-0.5" style={{fontFamily: "'Fraunces', serif", fontSize: '0.875rem'}}>Brew Predictor</p>
              <p className="leading-relaxed text-gray-400" style={{fontSize: '0.7rem'}}>{getBrewPrediction()}</p>
            </div>
          </div>

          <Button onClick={() => setView('brew')} className="w-full py-3 shadow-xl active:scale-95">
            Start Brewing <ChevronRight className="w-4 h-4" />
          </Button>
        </div>
      );

      const BrewSessionView = () => {
        const [timeLeft, setTimeLeft] = useState(0);
        const [isActive, setIsActive] = useState(false);
        const [stepIndex, setStepIndex] = useState(0);
        const [isFinished, setIsFinished] = useState(false);
        const [showSaveModal, setShowSaveModal] = useState(false);
        const timerRef = useRef(null);

        const currentStep = steps[stepIndex];
        const stepStartTime = steps.slice(0, stepIndex).reduce((acc, s) => acc + s.duration, 0);
        const stepTimeElapsed = Math.max(0, timeLeft - stepStartTime);

        useEffect(() => {
          if (isActive) {
            timerRef.current = window.setInterval(() => {
              setTimeLeft(t => {
                const nextTime = t + 1;
                const totalDurationBeforeNext = steps.slice(0, stepIndex + 1).reduce((acc, s) => acc + s.duration, 0);
                if (nextTime >= totalDurationBeforeNext) {
                  if (stepIndex < steps.length - 1) {
                    setStepIndex(prev => prev + 1);
                  } else {
                    setIsActive(false);
                    setIsFinished(true);
                  }
                }
                return nextTime;
              });
            }, 1000);
          } else if (timerRef.current) {
            clearInterval(timerRef.current);
          }
          return () => {
            if (timerRef.current) clearInterval(timerRef.current);
          };
        }, [isActive, stepIndex]);

        const formatTime = (seconds) => {
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${mins}:${secs.toString().padStart(2, '0')}`;
        };

        const handleSaveLog = (rating, notes) => {
          const newLog = {
            id: Date.now().toString(),
            date: new Date().toLocaleDateString(),
            origin,
            varietal,
            method,
            roast,
            rating,
            notes,
            coffeeAmount,
            ratio
          };
          setLogs([newLog, ...logs]);
          setView('history');
        };

        if (showSaveModal) {
          return (
            <SaveLogModal 
              onSave={handleSaveLog} 
              onCancel={() => setView('config')} 
            />
          );
        }

        return (
          <div className="flex flex-col h-[calc(100vh-5rem)]">
            <div className="flex items-center justify-between mb-4">
              <Button variant="ghost" onClick={() => setView('config')} className="!px-2 py-1">
                <ChevronLeft className="w-5 h-5" /> Back
              </Button>
              <div className="text-center">
                <span className="font-semibold tracking-widest text-purple-400 uppercase block mb-1" style={{fontSize: '0.75rem'}}>Session</span>
                <h2 className="font-semibold text-white capitalize" style={{fontFamily: "'Fraunces', serif", fontSize: '1rem'}}>{method.replace('_', ' ')}</h2>
              </div>
              <div className="w-12" />
            </div>

            <div className="flex-1 flex flex-col items-center justify-center space-y-6">
              <div className="relative w-56 h-56 flex items-center justify-center">
                <svg className="w-full h-full transform -rotate-90" viewBox="0 0 224 224">
                  <circle cx="112" cy="112" r="104" stroke="currentColor" strokeWidth="6" fill="transparent" className="text-gray-800" />
                  <circle
                    cx="112"
                    cy="112"
                    r="104"
                    stroke="url(#gradient)"
                    strokeWidth="6"
                    fill="transparent"
                    strokeDasharray={2 * Math.PI * 104}
                    strokeDashoffset={2 * Math.PI * 104 * (1 - (stepTimeElapsed / currentStep.duration))}
                    className="transition-all duration-1000 ease-linear"
                    strokeLinecap="round"
                  />
                  <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" stopColor="#a855f7" />
                      <stop offset="100%" stopColor="#22c55e" />
                    </linearGradient>
                  </defs>
                </svg>
                <div className="absolute inset-0 flex flex-col items-center justify-center">
                   <span className="font-bold text-white tabular-nums" style={{fontSize: '2rem'}}>
                      {formatTime(isActive || isFinished ? timeLeft : 0)}
                   </span>
                   <span className="text-gray-500 font-semibold uppercase tracking-widest mt-1" style={{fontSize: '0.65rem'}}>
                     Elapsed
                   </span>
                </div>
              </div>

              <div className="w-full text-center space-y-4 px-2">
                 <div className="bg-gradient-to-br from-purple-500/10 to-green-500/5 rounded-xl p-5 border border-purple-500/30">
                    <h3 className="font-semibold text-purple-300 mb-1" style={{fontFamily: "'Fraunces', serif", fontSize: '1.25rem'}}>{currentStep.name}</h3>
                    <p className="text-gray-400 mb-4 font-medium leading-relaxed" style={{fontSize: '0.875rem'}}>{currentStep.description}</p>
                    {currentStep.waterTarget && (
                      <div className="inline-flex flex-col bg-black/50 px-4 py-2 rounded-lg border border-green-500/30">
                        <span className="font-semibold text-gray-500 uppercase tracking-wider mb-0.5" style={{fontSize: '0.65rem'}}>Pour Water To</span>
                        <span className="font-bold text-green-400" style={{fontSize: '1.25rem'}}>{currentStep.waterTarget}g</span>
                      </div>
                    )}
                 </div>
                 
                 {isFinished && (
                   <div className="bg-green-500/20 text-green-400 p-3 rounded-lg flex items-center justify-center gap-2 border border-green-500/30">
                     <CheckCircle className="w-4 h-4" />
                     <span className="font-semibold" style={{fontFamily: "'Fraunces', serif", fontSize: '0.875rem'}}>Brew Ready!</span>
                   </div>
                 )}
              </div>
            </div>

            <div className="mt-auto grid grid-cols-2 gap-3 pb-4">
              {!isActive && !isFinished ? (
                <Button onClick={() => setIsActive(true)} className="col-span-2 py-3 shadow-lg">
                  <Play className="w-5 h-5" fill="currentColor" /> Start Timer
                </Button>
              ) : isFinished ? (
                <>
                   <Button onClick={() => setShowSaveModal(true)} variant="primary" className="py-3">
                     <Save className="w-4 h-4" /> Log
                   </Button>
                   <Button onClick={() => setView('config')} variant="secondary" className="py-3">
                     Reset
                   </Button>
                </>
              ) : (
                 <>
                    <Button onClick={() => setIsActive(false)} variant="secondary" className="py-3 shadow-md">
                      <Pause className="w-5 h-5" fill="currentColor" /> Pause
                    </Button>
                    <Button onClick={() => {
                      setIsActive(false);
                      setTimeLeft(0);
                      setStepIndex(0);
                    }} variant="danger" className="py-3 shadow-md">
                      <RotateCcw className="w-5 h-5" /> Stop
                    </Button>
                 </>
              )}
            </div>
          </div>
        );
      };

      const SaveLogModal = ({ onSave, onCancel }) => {
        const [rating, setRating] = useState(0);
        const [notes, setNotes] = useState('');

        return (
          <div className="space-y-4 pt-6">
            <h2 className="font-semibold text-center text-white" style={{fontFamily: "'Fraunces', serif", fontSize: '1.25rem'}}>Rate the Cup</h2>
            <Card>
              <div className="flex justify-center gap-2 mb-5">
                {[1, 2, 3, 4, 5].map((star) => (
                  <button 
                    key={star}
                    onClick={() => setRating(star)}
                    className="focus:outline-none transition-transform hover:scale-110 active:scale-95"
                  >
                    <Star 
                      className={`w-10 h-10 ${star <= rating ? 'text-purple-400' : 'text-gray-700'}`}
                      fill={star <= rating ? 'currentColor' : 'none'}
                    />
                  </button>
                ))}
              </div>

              <label className="block font-semibold text-gray-400 mb-1.5 uppercase tracking-wider" style={{fontSize: '0.65rem'}}>Tasting Notes</label>
              <textarea 
                className="w-full border border-gray-700 rounded-lg p-3 h-28 focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 focus:outline-none resize-none font-medium text-gray-200 bg-gray-800"
                placeholder="Describe the acidity, body, and finish..."
                value={notes}
                onChange={(e) => setNotes(e.target.value)}
                style={{fontSize: '0.875rem'}}
              />

              <div className="grid grid-cols-2 gap-3 mt-5">
                <Button variant="secondary" onClick={onCancel} className="py-2.5">Skip</Button>
                <Button onClick={() => onSave(rating, notes)} className="py-2.5">Save & Close</Button>
              </div>
            </Card>
          </div>
        );
      };

      const HistoryView = () => (
        <div className="h-[calc(100vh-5rem)] flex flex-col">
          <div className="flex items-center justify-between mb-4">
            <h2 className="font-semibold text-white" style={{fontFamily: "'Fraunces', serif", fontSize: '1.25rem'}}>Journal</h2>
            <Button variant="secondary" onClick={() => setView('config')} className="!px-3 !py-1.5 font-bold uppercase" style={{fontSize: '0.7rem'}}>
               New Brew
            </Button>
          </div>

          <div className="flex-1 overflow-y-auto space-y-3 pb-20">
            {logs.length === 0 ? (
              <div className="text-center text-gray-500 py-20 flex flex-col items-center">
                <History className="w-16 h-16 mb-4 opacity-20" />
                <p className="font-medium" style={{fontSize: '1rem'}}>Your coffee journey begins here.</p>
                <Button variant="ghost" onClick={() => setView('config')} className="mt-4 text-amber-600 font-bold underline">
                  Record your first brew
                </Button>
              </div>
            ) : (
              logs.map(log => (
                <Card key={log.id} className="!p-5 hover:border-purple-500/40 transition-colors">
                   <div className="flex justify-between items-start mb-4">
                     <div>
                       <h3 className="font-semibold text-white" style={{fontFamily: "'Fraunces', serif", fontSize: '1rem'}}>{log.origin}</h3>
                       <div className="flex items-center gap-2 mt-1">
                          <span className="bg-purple-500/20 text-purple-300 px-2 py-0.5 rounded font-semibold uppercase tracking-wide" style={{fontSize: '0.75rem'}}>
                            {log.varietal}
                          </span>
                          <span className="text-gray-500 font-medium" style={{fontSize: '0.75rem'}}>
                            {log.date}
                          </span>
                       </div>
                     </div>
                     <div className="flex items-center gap-1 bg-green-500/20 px-2.5 py-1 rounded-full ring-1 ring-green-500/30">
                        <Star className="w-3.5 h-3.5 text-green-400" fill="currentColor" />
                        <span className="font-bold text-green-400" style={{fontSize: '0.75rem'}}>{log.rating}</span>
                     </div>
                   </div>
                   
                   <div className="grid grid-cols-3 gap-2 mb-4">
                      <div className="bg-gray-800 rounded-lg p-2">
                         <span className="block font-bold text-green-400" style={{fontSize: '1rem'}}>{log.coffeeAmount}g</span>
                         <span className="text-gray-500 uppercase tracking-wider font-semibold" style={{fontSize: '0.75rem'}}>Coffee</span>
                      </div>
                      <div className="bg-gray-800 rounded-lg p-2">
                         <span className="block font-bold text-green-400" style={{fontSize: '1rem'}}>1:{log.ratio}</span>
                         <span className="text-gray-500 uppercase tracking-wider font-semibold" style={{fontSize: '0.75rem'}}>Ratio</span>
                      </div>
                      <div className="bg-gray-800 rounded-lg p-2">
                         <span className="block capitalize font-semibold text-gray-200" style={{fontSize: '1rem'}}>{log.roast}</span>
                         <span className="text-gray-500 uppercase tracking-wider font-semibold" style={{fontSize: '0.75rem'}}>Roast</span>
                      </div>
                   </div>

                   {log.notes && (
                     <p className="text-gray-400 italic border-l-2 border-purple-500/50 pl-3 py-1" style={{fontSize: '1rem'}}>
                       "{log.notes}"
                     </p>
                   )}
                </Card>
              ))
            )}
          </div>
        </div>
      );

      return (
        <div className="min-h-screen bg-black text-gray-100 font-sans selection:bg-purple-500/30">
          <nav className="fixed bottom-0 left-0 right-0 bg-black/90 backdrop-blur-md border-t border-purple-500/30 px-10 py-2 flex justify-around items-center z-50 md:hidden pb-safe">
             <button onClick={() => setView('config')} className={`flex items-center gap-2 px-4 py-1.5 rounded-full transition-all ${view === 'config' ? 'text-green-400 bg-green-400/10' : 'text-gray-500'}`}>
                <Coffee className="w-4 h-4" />
                <span className="font-semibold uppercase tracking-wider" style={{fontSize: '0.75rem'}}>Brew</span>
             </button>
             <button onClick={() => setView('history')} className={`flex items-center gap-2 px-4 py-1.5 rounded-full transition-all ${view === 'history' ? 'text-green-400 bg-green-400/10' : 'text-gray-500'}`}>
                <History className="w-4 h-4" />
                <span className="font-semibold uppercase tracking-wider" style={{fontSize: '0.75rem'}}>Journal</span>
             </button>
          </nav>

          <main className="px-4 py-5 min-h-screen pb-24 md:pb-8 max-w-md mx-auto">
            {view === 'config' && configView}
            {view === 'brew' && <BrewSessionView />}
            {view === 'history' && <HistoryView />}
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>